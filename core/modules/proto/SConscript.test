# -*- python -*-
Import('env')
Import('libProducts')

import os
import itertools


programs = []
obj = env.Object("testProtocol.cc")
def convertObj(o):
    oStr = str(o)
    # Avoid questionable conflict with .o for SharedLibrary
    # production by using an alt name.
    if oStr.endswith(".cc"): return env.Object(oStr+".staticobj", o)
    return o
libObjs = map(convertObj, libProducts['proto'])
extDeps = ['pthread', 'protobuf', 'libssl'] + libObjs + ['libcrypto'] + "log log4cxx".split()
p = env.Program(source=[obj], LIBS=extDeps)
programs.append(p)

# add a unit test which runs on every build
utest = env.UnitTest(p)
env.Append(UNIT_TESTS=utest)

Return('programs')
