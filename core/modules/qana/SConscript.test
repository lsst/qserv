# -*- python -*-
# SConscript for qana
Import('env')
Import('libProducts')
Import('defaultTgts')
Import('findLibs')
Import('cacheObjs')

import os
import itertools


programs = []
# extDeps
extDeps = "antlr boost_thread boost_system crypto log log4cxx ssl zookeeper_mt".split()

modDeps = 'css global log query util'.split() # deps on other modules
pDeps = itertools.chain(*map(lambda m: libProducts[m], modDeps))
pDeps = cacheObjs(env, pDeps, ".o")

localdeps = map(env.Object,
                ['QueryPlugin.cc',
                 'QservRestrictorPlugin.cc',
                 'DuplSelectExprPlugin.cc']
               )
p = env.Program(['testPlugins.cc'] + localdeps + pDeps, LIBS=findLibs(extDeps))
programs.append(p)

p = env.Program(['testDuplSelectExprPlugin.cc', ] + localdeps + pDeps,
LIBS=findLibs(extDeps))
programs.append(p)

# add a unit test which runs on every build
utest = env.UnitTest(p)
env.Append(UNIT_TESTS=map(env.UnitTest, programs))

Return('programs')
